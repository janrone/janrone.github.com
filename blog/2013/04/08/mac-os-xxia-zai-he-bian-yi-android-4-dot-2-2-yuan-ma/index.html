
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Mac OS x下载和编译Android 4.2.2 源码 - Janrone's Blog</title>
  <meta name="author" content="Janrone">

  
  <meta name="description" content="创建一个映像用来下载android源码 1, $ hdiutil create -type SPARSE -fs &#8216;Case-sensitive Journaled HFS+&#8217; -size 40g ~/android.sparseimage 2, $ hdiutil &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://janrone.github.com/blog/2013/04/08/mac-os-xxia-zai-he-bian-yi-android-4-dot-2-2-yuan-ma/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Janrone's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Janrone's Blog</a></h1>
  
    <h2>The gold housese in the books .</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:janrone.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Mac OS x下载和编译Android 4.2.2 源码</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-04-08T15:56:00+08:00" pubdate data-updated="true">Apr 8<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><h3>创建一个映像用来下载android源码</h3>

<p>1, $ hdiutil create -type SPARSE -fs &#8216;Case-sensitive Journaled HFS+&#8217; -size 40g ~/android.sparseimage</p>

<p>2, $ hdiutil attach ~/android.sparseimage -mountpoint /Volumes/android</p>

<p>3,  $ mkdir ~/bin</p>

<p>4,  $ PATH=~/bin:$PATH</p>

<p>5,  $ curl https://dl-ssl.google.com/dl/googlesource/git-repo/repo > ~/bin/repo</p>

<p>6,  $ chmod a+x ~/bin/repo</p>

<p>7,  $ cd /Volumes/android/</p>

<p>8,  $ mkdir WORKING_DIRECTORY</p>

<p>9,  $ CD WORKING_DIRECTORY/</p>

<p>10, $ repo init -u https://android.googlesource.com/platform/manifest -b android-4.2.2_r1</p>

<p>11, $repo sync</p>

<!-- more -->


<h3>设置必要的编译环境初始化编译环境：</h3>

<p>1, $source build/envsetup.sh</p>

<p>2, 选择编译目标 $lunch full-eng</p>

<h3>开始编译代码</h3>

<p>$make -j8</p>

<p>开始时间 2013－03-28 19:17 <br/>
编译到了 40分钟左右的时候出现了错误 No space left on device，看错误3解决方法。<br/>
之后接着编译 make 这次没有是用 －j,因为心疼电脑，嘿嘿 ，大概半小时编译完成。</p>

<p>nstalled file list: out/target/product/generic/installed-files.txt<br/>
Target system fs image: out/target/product/generic/obj/PACKAGING/systemimage_intermediates/system.img<br/>
Running:  mkyaffs2image -f out/target/product/generic/system out/target/product/generic/obj/PACKAGING/systemimage_intermediates/system.img<br/>
Install system fs image: out/target/product/generic/system.img</p>

<p>编译完成后运行：emulator -kernel ./prebuilts/qemu-kernel/arm/kernel-qemu -sysdir ./out/target/product/generic -system system.img -data userdata.img -ramdisk ramdisk.img</p>

<p>出现错误 qemu: could not load initrd &#8216;ramdisk.img&#8217;，看错误4解决方法</p>

<p>直接运行：
emulator -kernel ./prebuilts/qemu-kernel/arm/kernel-qemu-armv7 -sysdir ./out/target/product/generic/ -system system.img -data userdata.img</p>

<h2>最终结果图 ：</h2>

<p><img src="/images/post/2013-04-08-01.png" alt="" /></p>

<hr />

<h3>错误 1</h3>

<p>在android4.0源码中，mm编译apk时出现下面的错误：</p>

<pre><code>make: *** No rule to make target `out/target/common/obj/JAVA_LIBRARIES/android_stubs_current_intermediates/javalib.jar', needed by `out/target/common/obj/APPS/NativeTimer_intermediates/classes-full-debug.jar'.  Stop.
</code></pre>

<p>解决方法：
在源码根目录执行：
make clobber
make -j8</p>

<p>这个错误的好像是由于在make一个任务时，并没有结束，这时在进行make就会报
make clobber的功能是把上一次make命令生成的文件或目录清除掉，效果比make clean更严格。
这样编译完成后，在编译apk就可以了。</p>

<hr />

<h3>错误2</h3>

<p>povolmatoMacBook-Pro:untitled povol$ source build/envsetup.sh<br/>
including device/asus/grouper/vendorsetup.sh<br/>
including device/asus/tilapia/vendorsetup.sh<br/>
including device/generic/armv7-a-neon/vendorsetup.sh<br/>
including device/generic/armv7-a/vendorsetup.sh<br/>
including device/generic/mips/vendorsetup.sh<br/>
including device/generic/x86/vendorsetup.sh<br/>
including device/lge/mako/vendorsetup.sh<br/>
including device/samsung/maguro/vendorsetup.sh<br/>
including device/samsung/manta/vendorsetup.sh<br/>
including device/samsung/toro/vendorsetup.sh<br/>
including device/samsung/toroplus/vendorsetup.sh<br/>
including device/ti/panda/vendorsetup.sh<br/>
including sdk/bash_completion/adb.bash</p>

<pre><code>povolmatoMacBook-Pro:untitled povol$ lunch full-eng
build/core/combo/HOST_darwin-x86.mk:62: *****************************************************
build/core/combo/HOST_darwin-x86.mk:63: * Cannot find SDK 10.6 at /Applications/Xcode.app/
Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.6.sdk
build/core/combo/HOST_darwin-x86.mk:65: * If you wish to build using higher version of SDK, 
build/core/combo/HOST_darwin-x86.mk:66: * try setting BUILD_MAC_SDK_EXPERIMENTAL=1 before 
build/core/combo/HOST_darwin-x86.mk:67: * rerunning this command 
build/core/combo/HOST_darwin-x86.mk:69: *****************************************************
build/core/combo/HOST_darwin-x86.mk:70: *** Stop..  Stop.

** Don't have a product spec for: 'full'
** Do you have the right repo manifest?


//**//找不到mac os x sdk 10.6 执行 
povolmatoMacBook-Pro:untitled povol$ export BUILD_MAC_SDK_EXPERIMENTAL=1

povolmatoMacBook-Pro:untitled povol$ lunch full-eng

一些初始化信息

============================================
PLATFORM_VERSION_CODENAME=REL
PLATFORM_VERSION=4.2.2
TARGET_PRODUCT=full
TARGET_BUILD_VARIANT=eng
TARGET_BUILD_TYPE=release
TARGET_BUILD_APPS=
TARGET_ARCH=arm
TARGET_ARCH_VARIANT=armv7-a
HOST_ARCH=x86
HOST_OS=darwin
HOST_OS_EXTRA=Darwin-12.3.0-x86_64-i386-64bit
HOST_BUILD_TYPE=release
BUILD_ID=JDQ39
OUT_DIR=out
</code></pre>

<p>============================================</p>

<p>povolmatoMacBook-Pro:untitled povol$</p>

<p>========================================================</p>

<h3>错误3</h3>

<pre><code>/Volumes/untitled/prebuilts/gcc/darwin-x86/arm/arm-linux-androideabi-4.6/bin/../lib/gcc/arm-linux-androideabi/4.6.x-google/../../../../arm-linux-androideabi/bin/ld: fatal error: out/target/product/generic/obj/SHARED_LIBRARIES/libmock_ril_intermediates/LINKED/libmock_ril.so: No space left on device
collect2: ld returned 1 exit status
make: *** [out/target/product/generic/obj/SHARED_LIBRARIES/libmock_ril_intermediates/LINKED/libmock_ril.so] Error 1
make: *** Waiting for unfinished jobs....
/Volumes/untitled/prebuilts/gcc/darwin-x86/arm/arm-linux-androideabi-4.6/bin/../lib/gcc/arm-linux-androideabi/4.6.x-google/../../../../arm-linux-androideabi/bin/ld: warning: hidden symbol 'mkstemp' in out/target/product/generic/obj/SHARED_LIBRARIES/libchromium_net_intermediates/base/file_util_android.o is referenced by DSO out/target/product/generic/obj/lib/libcutils.so
/Volumes/untitled/prebuilts/gcc/darwin-x86/arm/arm-linux-androideabi-4.6/bin/../lib/gcc/arm-linux-androideabi/4.6.x-google/../../../../arm-linux-androideabi/bin/ld: fatal error: out/target/product/generic/obj/SHARED_LIBRARIES/libchromium_net_intermediates/LINKED/libchromium_net.so: No space left on device
collect2: ld returned 1 exit status
make: *** [out/target/product/generic/obj/SHARED_LIBRARIES/libchromium_net_intermediates/LINKED/libchromium_net.so] Error 1
/Volumes/untitled/prebuilts/gcc/darwin-x86/arm/arm-linux-androideabi-4.6/bin/../lib/gcc/arm-linux-androideabi/4.6.x-google/../../../../arm-linux-androideabi/bin/ld: fatal error: out/target/product/generic/obj/SHARED_LIBRARIES/libbcc_intermediates/LINKED/libbcc.so: No space left on device
collect2: ld returned 1 exit status
make: *** [out/target/product/generic/obj/SHARED_LIBRARIES/libbcc_intermediates/LINKED/libbcc.so] Error 1
</code></pre>

<p>解决：</p>

<p>执行 df －li 查看 iused  我的在untitled 显示100%</p>

<pre><code>povolmatoMacBook-Pro:untitled povol$ df -li 
Filesystem   512-blocks      Used Available Capacity  iused    ifree %iused  Mounted on
/dev/disk0s2  777343744 450761888 326069856    59% 56409234 40758732   58%   /
/dev/disk0s4  197748728  82422896 115325832    42%   183830 57683118    0%   /Volumes/BOOTCAMP
/dev/disk1      8388608   1611096   6777512    20%   201385   847189   19%   /Volumes/RamDisk

/dev/disk3s2   83214256  83193528     20728   100% 10399189     2591  100%   /Volumes/untitled
</code></pre>

<p>所以提示 No space left on device</p>

<p>重新启动了mac之后</p>

<pre><code>povolmatoMacBook-Pro:android povol$ df -li 
Filesystem   512-blocks      Used Available Capacity  iused    ifree %iused  Mounted on
/dev/disk0s2  777343744 482859288 293972456    63% 60421409 36746557   62%   /

/dev/disk0s4  197748728  82422896 115325832    42%   183830 57683118    0%   /Volumes/BOOTCAMP

/dev/disk1      8388608     73632   8314976     1%     9202  1039372    1%   /Volumes/RamDisk

/dev/disk3s2   83214256  50383960  32830296    61%  6297993  4103787   61%   /Volumes/untitled
</code></pre>

<p>这次显示／Volumes/untitled iused 为61% 接着运行 make
编译成功 。</p>

<p> <br/></p>

<hr />

<h3>错误 4</h3>

<p>qemu: could not load initrd &#8216;ramdisk.img&#8217;，</p>

<p>直接参数-ramdisk ramdisk.img去掉，结果模拟器跑起来了，是运行出窗口后，就是黑屏。</p>

<p>换下kernel，用./prebuilts/qemu-kernel/arm/kernel-qemu-armv7，之后运行成功 。</p>

<br/><br/><br/>



</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Janrone</span></span>

      








  


<time datetime="2013-04-08T15:56:00+08:00" pubdate data-updated="true">Apr 8<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/android/'>Android</a>, <a class='category' href='/blog/categories/work/'>Work</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://janrone.github.com/blog/2013/04/08/mac-os-xxia-zai-he-bian-yi-android-4-dot-2-2-yuan-ma/" data-via="" data-counturl="http://janrone.github.com/blog/2013/04/08/mac-os-xxia-zai-he-bian-yi-android-4-dot-2-2-yuan-ma/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/01/12/zen-yao-da-jian-octopress-zai-github/" title="Previous Post: 怎么搭建 Octopress 在 github ! ">&laquo; 怎么搭建 Octopress 在 github ! </a>
      
      
        <a class="basic-alignment right" href="/blog/2013/04/09/zai-androidshang-da-jian-pythonhuan-jing/" title="Next Post: 在Android上搭建Python环境">在Android上搭建Python环境 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section id="date">

    <head>
<script language="javascript" type="text/javascript"> 

    function fomateDate(oDate, sFomate, bZone)
    {
        sFomate = sFomate.replace("YYYY", oDate.getFullYear());
        sFomate = sFomate.replace("YY", String(oDate.getFullYear()).substr(2))
        sFomate = sFomate.replace("MM", oDate.getMonth()+1)
        sFomate = sFomate.replace("DD", oDate.getDate());
        sFomate = sFomate.replace("hh", oDate.getHours());
        sFomate = sFomate.replace("mm", oDate.getMinutes());
        sFomate = sFomate.replace("ss", oDate.getSeconds());
        if (bZone) sFomate = sFomate.replace(/\b(\d)\b/g, '0$1');
        return sFomate;
    }

    var DateOne = '2014-03-10';
    var DateTwo = fomateDate(new Date(), 'YYYY-MM-DD');
    
    var OneMonth = DateOne.substring(5,DateOne.lastIndexOf ('-'));  
    var OneDay = DateOne.substring(DateOne.length,DateOne.lastIndexOf ('-')+1);  
    var OneYear = DateOne.substring(0,DateOne.indexOf ('-'));  
  
    var TwoMonth = DateTwo.substring(5,DateTwo.lastIndexOf ('-'));  
    var TwoDay = DateTwo.substring(DateTwo.length,DateTwo.lastIndexOf ('-')+1);  
    var TwoYear = DateTwo.substring(0,DateTwo.indexOf ('-'));  
  
    var cha=((Date.parse(OneMonth+'/'+OneDay+'/'+OneYear)- Date.parse(TwoMonth+'/'+TwoDay+'/'+TwoYear))/86400000);   
	
	
	document.getElementById('showdate').innerHTML = '认识珊珊已经' + Math.abs(cha) + '天';	

</script>

</head>
<!--
    daysBetween('2014-03-10',fomateDate(new Date(), 'YYYY-MM-DD'));
    function daysBetween(DateOne,DateTwo)  

    onload="daysBetween('2014-03-10',fomateDate(new Date(), 'YYYY-MM-DD'))" -->
<body>
<h1>Meetday</h1>
<br/>
<div id="showdate" >  </div>

</body>
</section>
<section>
  <ul id="social">
    <li class="post">
      <a href="http://janrone.github.com" alt="Home"><img src="/images/home.png"></a>
      <a href="https://github.com/" target="_blank" alt="Github"><img src="/images/github.png"></a>
      <a href="http://twitter.com/" target="_blank" alt="Twitter"><img src="/images/twitter.png"></a>
      <a href="http://weibo.com/" target="_blank" alt="Weibo"><img src="/images/weibo.png"></a>
      <a href="mailto:" alt="E-Mail"><img src="/images/message.png"></a>
    </li>
  </ul>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/04/09/wan-ju-nexusshou-ji/">玩具Nexus手机</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/23/anroidying-yong-zi-dong-da-bao/">Anroid应用自动打包</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/14/think-python/">Think Python</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/09/zai-androidshang-da-jian-pythonhuan-jing/">在Android上搭建Python环境</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/08/mac-os-xxia-zai-he-bian-yi-android-4-dot-2-2-yuan-ma/">Mac OS x下载和编译Android 4.2.2 源码</a>
      </li>
    
  </ul>
</section>
<section id="comment_sidebar">
  <h1>Recent Comments</h1>
  <script type="text/javascript" src="http://janronesblog.disqus.com/recent_comments_widget.js?num_items=5&hide_avatars=0&avatar_size=32&excerpt_length=20"></script>
</section>





<section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/blog/categories/android'>Android (3)</a></li><li><a href='/blog/categories/git'>Git (1)</a></li><li><a href='/blog/categories/github'>GitHub (1)</a></li><li><a href='/blog/categories/nexus4-'>Nexus4, (1)</a></li><li><a href='/blog/categories/octopress'>Octopress (1)</a></li><li><a href='/blog/categories/python'>Python (2)</a></li><li><a href='/blog/categories/read'>Read (1)</a></li><li><a href='/blog/categories/root'>Root (1)</a></li><li><a href='/blog/categories/work'>Work (3)</a></li><li><a href='/blog/categories/解锁-'>解锁, (1)</a></li></ul>
</section>
<section id="blogroll">
<h1>Blogroll</h1>
<ul  style="padding-left:0">
	<li><a target="_blank" href="http://caok.github.com/">Caok's Blog</a></li>
	<li><a target="_blank" href="http://www.udpwork.com/">IT牛人博客聚合</a></li>
	<li><a target="_blank" href="http://yanping.me/cn/">雁起平沙</a></li>
	<li><a target="_blank" href="http://loyhome.com">丽云</a></li>
	<li><a target="_blank" href="http://bjt.name">刘思喆</a></li>
	<li><a target="_blank" href="http://jliblog.com">李舰</a></li>
	<li><a target="_blank" href="http://tracy.cos.name/cn">熊熹师姐</a></li>
	<li><a target="_blank" href="http://fan.cos.name">范建宁</a></li>
	<li><a target="_blank" href="http://yihui.name/cn">谢益辉</a></li>
	<li><a target="_blank" href="http://yishuo.org">邓一硕</a></li>
	<li><a target="_blank" href="http://yixuan.cos.name/cn">邱怡轩</a></li>
	<li><a target="_blank" href="http://taiyun.cos.name">魏太云</a></li>
	<li><a target="_blank" href="http://www.madeye.me/">MADEYE</a></li>
	<li><a target="_blank" href="http://ryantang.me/">Ryan's Zone</a></li> 
</ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Janrone -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'janronesblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://janrone.github.com/blog/2013/04/08/mac-os-xxia-zai-he-bian-yi-android-4-dot-2-2-yuan-ma/';
        var disqus_url = 'http://janrone.github.com/blog/2013/04/08/mac-os-xxia-zai-he-bian-yi-android-4-dot-2-2-yuan-ma/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
